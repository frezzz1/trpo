# ADR 2025-12.4  
## Анализ архитектурных паттернов для системы управления лояльностью клиентов

---

## 1. Информация о ADR

- **Дата:** 13 декабря 2025 г.  
- **Статус:** Принято  
- **Название:** Анализ и выбор архитектурных паттернов для системы управления лояльностью клиентов

---

## 2. Контекст

Система управления лояльностью клиентов разрабатывается для обслуживания до **250 000 пользователей** и должна удовлетворять следующим нефункциональным требованиям:

- **Производительность** (PER01–PER04)  
- **Масштабируемость** (SCA01–SCA05)  
- **Доступность** (AVA01)  
- **Надёжность и долговечность данных** (DUR01–DUR03)

Архитектура системы основана на **Kotlin / Spring Boot** и изначально реализуется в виде **модульного монолита** с возможностью дальнейшей эволюции.

Ключевые функциональные области:
- начисление и списание бонусных баллов,
- управление акциями,
- аналитика и отчётность,
- уведомления и интеграции.

---

## 3. Рассмотренные архитектурные паттерны

### Трёхзвенная структура
**Плюсы:**
- Чёткое разделение ответственности  
- Упрощение тестирования и поддержки  

**Минусы:**
- Дополнительные накладные расходы  

---

### Кеширование и инвалидация кеша
**Плюсы:**
- Существенное снижение нагрузки на БД  
- Ускорение API-ответов  

**Минусы:**
- Риск устаревших данных  
- Сложность инвалидации  

---

### Толстый клиент
**Плюсы:**
- Снижение серверной нагрузки  

**Минусы:**
- Сложность обновлений  
- Зависимость от платформы клиента  

---

### Деградация функциональности
**Плюсы:**
- Повышение доступности  
- Сохранение ключевых бизнес-функций  

**Минусы:**
- Асинхронная консистентность  
- Дополнительная логика восстановления  

---

### Масштабирование (горизонтальное, вертикальное, во времени)
**Плюсы:**
- Гибкость роста  
- Эффективное использование ресурсов  

**Минусы:**
- Усложнение инфраструктуры  
- Рост затрат  

---

### SOA и монолит
**Плюсы монолита:**
- Простота развертывания  
- Отсутствие сетевых накладных расходов  

**Минусы:**
- Ограниченное независимое масштабирование  

---

### Индексы в базе данных
**Плюсы:**
- Предсказуемая и высокая производительность запросов  

**Минусы:**
- Замедление операций записи  

---

### Репликация
**Плюсы:**
- Повышение доступности  
- Балансировка чтения  

**Минусы:**
- Задержки репликации  
- Усложнение мониторинга  

---

### Шардинг и партиционирование
**Плюсы:**
- Масштабируемость  
- Изоляция нагрузки  

**Минусы:**
- Сложность распределённых запросов  

---

### Денормализация
**Плюсы:**
- Быстрая аналитика и отчётность  

**Минусы:**
- Дублирование данных  

---

### Функциональное разделение
**Плюсы:**
- Слабая связанность  
- Упрощение поддержки  

**Минусы:**
- Требует строгих границ модулей  

---

### Отложенные вычисления
**Плюсы:**
- Снижение пиковой нагрузки  

**Минусы:**
- Неактуальные данные в реальном времени  

---

### Асинхронная обработка
**Плюсы:**
- Неблокирующая обработка  
- Повышение отказоустойчивости  

**Минусы:**
- Сложность отладки  

---

### Конвейер и параллельные выполнения
**Плюсы:**
- Параллельность  
- Эффективное использование CPU  

**Минусы:**
- Сложность управления потоками  

---

### Event-Driven Architecture (EDA)
**Плюсы:**
- Слабая связанность  
- Подготовка к микросервисной архитектуре  

**Минусы:**
- Повышенные требования к мониторингу  

---

## 4. Принятое архитектурное решение

Принято решение использовать:

- **Модульный монолит** как основной архитектурный стиль  
- **Трёхзвенную архитектуру** внутри каждого модуля  
- **Event-Driven взаимодействие** между модулями  
- **Асинхронную обработку** для уведомлений и интеграций  
- **Кеширование, индексы и репликацию** для повышения производительности  
- **Партиционирование и отложенные вычисления** для аналитики  

### Применение паттернов по компонентам

| Компонент | Применяемые паттерны |
|---------|---------------------|
| Просмотр баланса и акций | Кеширование, индексы, репликация |
| Начисление и списание баллов | Асинхронная обработка, партиционирование |
| Аналитика и отчёты | Денормализация, отложенные вычисления |
| Уведомления | Event-driven, конвейер |
| Ядро системы | Трёхзвенная структура, масштабирование |

---

## 5. Обоснование выбора

Выбранная архитектура позволяет:

- удовлетворить текущие нефункциональные требования без избыточной сложности;
- обеспечить высокую производительность при пиковых нагрузках;
- сохранить простоту разработки и развертывания;
- подготовить систему к последующей эволюции в сторону SOA или микросервисов;
- минимизировать инфраструктурные и операционные риски на ранних этапах.

Модульный монолит признан оптимальным компромиссом между гибкостью и сложностью.

---

## 6. Последствия

### Технические
- Требуется строгое соблюдение модульных границ  
- Необходим комплексный мониторинг событий и метрик  

### Операционные
- Простота CI/CD и развертывания  
- Ограниченное независимое масштабирование компонентов  

### Бизнес
- Готовность системы к росту до 100k+ пользователей  
- Высокая доступность и стабильность ключевых функций  

---
